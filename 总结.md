#1.建立工程结构
- gmall_interface:这是公共接口层（API层），相关的服务接口、服务model、服务异常等可放入这个工程中
符合分包原则：重用发布等价原则(REP)，共同重用原则(CRP)。
- gmall_user:这个是服务提供者工程，也是用户服务的实现工程。
- gmall_order:这个是服务消费者工程，也是订单服务的实现工程。
- gmll_user和gmall_order均依赖了gmll_interface。这也是dubbo所建议的。
#2.使用dubbo对各个工程进行改造
1. 再gmall_user中引入dubbo相关依赖：
    ```xml
    <!-- 引入dubbo -->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>dubbo</artifactId>
        <version>2.6.2</version>
    </dependency>
    
    <!-- 由于我们使用zookeeper作为注册中心，所以需要操作zookeeper
        dubbo 2.6以前的版本引入zkclient操作zookeeper
        dubbo 2.6及以后的版本引入curator操作zookeeper
        下面两个zk客户端根据dubbo版本2选1即可
     -->
    <!--<dependency>
        <groupId>com.101tec</groupId>
        <artifactId>zkclient</artifactId>
        <version>0.10</version>
    </dependency>-->
    <!-- curator-framework -->
    <dependency>
        <groupId>org.apache.curator</groupId>
        <artifactId>curator-framework</artifactId>
        <version>2.12.0</version>
    </dependency>
    ```
2. 配置gmall_user成为服务提供者，在resources中新建配置文件：
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
    	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    	xmlns:dubbo="http://code.alibabatech.com/schema/dubbo"
    	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
    		http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd
    		http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd">
    
    	<!-- 1、指定当前服务/应用的名字（同样的服务名字相同，不要和别的服务同名） -->
    	<dubbo:application name="user-service-provider"></dubbo:application>
    	
    	<!-- 2、指定注册中心的位置 -->
    	<!-- <dubbo:registry address="zookeeper://127.0.0.1:2181"></dubbo:registry> -->
    	<dubbo:registry protocol="zookeeper" address="192.168.25.132:2181"></dubbo:registry>
    	
    	<!-- 3、指定通信规则（通信协议？通信端口） -->
    	<dubbo:protocol name="dubbo" port="20882"></dubbo:protocol>
    	
    	<!-- 4、暴露服务   ref：指向服务的真正的实现对象 -->
    	<dubbo:service interface="com.xiaojihua.gmall.service.UserService"
    		ref="userServiceImpl01" timeout="1000" version="1.0.0">
    		<dubbo:method name="getUserAddressList" timeout="1000"></dubbo:method>
    	</dubbo:service>
    
    	<bean id="userServiceImpl01" class="com.xiaojihua.gmall.service.impl.UserServiceImpl"></bean>
    	
    </beans>
    ```
3. 在主类中写方法测试服务提供者
    ```java
    public class MyApplication
    {
        /**
         * 启动spring应用，测试服务提供者
         * @param args
         */
        public static void main( String[] args ) throws IOException {
            ClassPathXmlApplicationContext contex = new ClassPathXmlApplicationContext("provider.xml");
            System.in.read();
        }
    }
    
    ```
4. 进入dubbo-admin观察看是否正常有服务提供者注册了。
5. 使用dubbo改造gmall_order，引入相关依赖与gmall_user一样。
6. 配置gmall_order成为服务消费者，在resources中新建配置文件：
    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <beans xmlns="http://www.springframework.org/schema/beans"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:dubbo="http://dubbo.apache.org/schema/dubbo"
        xmlns:context="http://www.springframework.org/schema/context"
        xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.3.xsd
            http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd
            http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd">
        <context:component-scan base-package="com.xiaojihua.gmall.service.impl"></context:component-scan>
    
    
        <dubbo:application name="order-service-consumer"></dubbo:application>
        
        <dubbo:registry address="zookeeper://192.168.25.132:2181"></dubbo:registry>
        
        <!--  配置本地存根-->
        
        <!--声明需要调用的远程服务的接口；生成远程服务代理  -->
        <!-- 
            1）、精确优先 (方法级优先，接口级次之，全局配置再次之)
            2）、消费者设置优先(如果级别一样，则消费方优先，提供方次之)
        -->
        <!-- timeout="0" 默认是1000ms-->
        <!-- retries="":重试次数，不包含第一次调用，0代表不重试-->
        <!-- 幂等（设置重试次数）【查询、删除、修改】、非幂等（不能设置重试次数）【新增】 -->
        <dubbo:reference interface="com.xiaojihua.gmall.service.UserService"
            id="userService" timeout="5000" retries="3" version="*">
            <!-- <dubbo:method name="getUserAddressList" timeout="1000"></dubbo:method> -->
        </dubbo:reference>
            
        <!-- 配置当前消费者的统一规则：所有的服务都不检查 -->
        <dubbo:consumer check="false" timeout="5000"></dubbo:consumer>
    
        
    </beans>
    
    ```
7. 编写测试主类
    ```java
    package com.xiaojihua;
    
    import com.xiaojihua.gmall.bean.UserAddress;
    import com.xiaojihua.gmall.service.OrderService;
    import org.springframework.context.support.ClassPathXmlApplicationContext;
    
    import java.io.IOException;
    import java.util.List;
    
    /**
     * Hello world!
     *
     */
    public class MyOrderApplication
    {
        /**
         * 启动服务消费者
         * @param args
         * @throws IOException
         */
        public static void main( String[] args ) throws IOException {
            ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext("consumer.xml");
    
            OrderService orderService = applicationContext.getBean(OrderService.class);
    
            List<UserAddress> userAddresses = orderService.initOrder("1");
            for(UserAddress a : userAddresses){
                System.out.println(a.getUserAddress());
            }
            //System.out.println(userAddresses);
            System.out.println("调用完成....");
            //System.in.read();
        }
    }
    
    ```
8. 
